(function(e){var t=Object.prototype,i=window,n=document,r=navigator,s={ready:!1,callbacks:[],markReady:function(){s.ready=!0;for(var e=s.callbacks.pop();e;)e(),e=s.callbacks.pop()},check:function(){return"complete"==n.readyState||n.addEventListener&&"loaded"==n.readyState?(s.markReady(),!0):!1},listen:function(){this.check()||(n.addEventListener?(n.addEventListener("DOMContentLoaded",this.markReady,!0),n.addEventListener("readystatechange",this.check,!0),i.addEventListener("load",this.markReady,!0)):n.attachEvent&&(n.attachEvent("onreadystatechange",this.check),i.attachEvent("onload",this.markReady)))},wait:function(e){this.ready?e():this.callbacks.push(e)}};s.listen();var o={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,i,n,r,s,a,c,l="",u=0;for(e=o.utf8_encode(e);e.length>u;)t=e.charCodeAt(u++),i=e.charCodeAt(u++),n=e.charCodeAt(u++),r=t>>2,s=(3&t)<<4|i>>4,a=(15&i)<<2|n>>6,c=63&n,isNaN(i)?a=c=64:isNaN(n)&&(c=64),l=l+this.keyStr.charAt(r)+this.keyStr.charAt(s)+this.keyStr.charAt(a)+this.keyStr.charAt(c);return l},utf8_encode:function(e){var t=String.fromCharCode;e=e.replace(/\r\n/g,"\n");for(var i="",n=0;e.length>n;n++){var r=e.charCodeAt(n);128>r?i+=t(r):r>127&&2048>r?(i+=t(192|r>>6),i+=t(128|63&r)):(i+=t(224|r>>12),i+=t(128|63&r>>6),i+=t(128|63&r))}return i}},a=function(e){var i,n,r,s=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},a=function(e){return s.lastIndex=0,s.test(e)?'"'+e.replace(s,function(e){var t=o[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'},c=function(e,s){var o,l,d,f,g,p=i,v=s[e];switch(v&&"object"==typeof v&&"function"==typeof v.toJSON&&(v=v.toJSON(e)),v&&u.isDate(v)&&(v=h(v)),"function"==typeof r&&(v=r.call(s,e,v)),typeof v){case"string":return a(v);case"number":return isFinite(v)?v+"":"null";case"boolean":case"null":return v+"";case"object":if(!v)return"null";if(i+=n,g=[],"[object Array]"===t.toString.apply(v)){for(f=v.length,o=0;f>o;o+=1)g[o]=c(o,v)||"null";return d=0===g.length?"[]":i?"[\n"+i+g.join(",\n"+i)+"\n"+p+"]":"["+g.join(",")+"]",i=p,d}if(r&&"object"==typeof r)for(f=r.length,o=0;f>o;o+=1)"string"==typeof r[o]&&(l=r[o],d=c(l,v),d&&g.push(a(l)+(i?": ":":")+d));else for(l in v)t.hasOwnProperty.call(v,l)&&(d=c(l,v),d&&g.push(a(l)+(i?": ":":")+d));return d=0===g.length?"{}":i?"{\n"+i+g.join(",\n"+i)+"\n"+p+"}":"{"+g.join(",")+"}",i=p,d}};return c("",{"":e})},c={get:function(e){var t=0;if(document.cookie.match("^"+e+"=")||(t=document.cookie.indexOf("; "+e+"="),-1!==t&&(t+=2)),-1!==t){var i=document.cookie.indexOf(";",t);return-1===i&&(i=document.cookie.length),unescape(document.cookie.substring(t+e.length+1,i))}return""},set:function(e,t,i,n,r,s){t=""+t;var o=[escape(e),"=",escape(t)];if(i){var a=new Date;a.setDate(a.getDate()+i),o.push("; expires=",a.toGMTString())}n&&o.push("; domain=",n),r&&o.push("; path=",r),s&&o.push("; secure"),document.cookie=o.join("")}},l=t.toString;Array.prototype.slice;var u={extend:function(e,t){for(var i in t)e[i]=t[i];return e},clean:function(e){var t=0;for(var i in e)e[i]?t+=1:delete e[i];return t},keys:Object.keys||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var i=[];for(var n in e)t.hasOwnProperty.call(e,n)&&(i[i.length]=n);return i},isObject:function(e){return e===Object(e)},isString:function(e){return"[object String]"==l.call(e)},isNumber:function(e){return"[object Number]"==l.call(e)},isFunction:function(e){return"[object Function]"==l.call(e)},isNaN:function(e){return e!==e},isBoolean:function(e){return e===!0||e===!1||"[object Boolean]"==l.call(e)},isDate:function(e){return"[object Date]"==l.call(e)},isArray:Array.isArray||function(e){return"[object Array]"==l.call(e)},isDefined:function(e){return e!==void 0},isValidPrimitiveValue:function(e){return this.isString(e)||this.isNumber(e)&&!this.isNaN(e)||this.isBoolean(e)||this.isDate(e)},isEmail:function(e){return this.isString(e)&&/\S+@\S+\.\S{2,4}/.test(e)},now:function(){return(new Date).getTime()}},d={create:function(){var e=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+e()+e()}},h=function(e){function t(e,t){for(e=""+e,t=t||2;t>e.length;)e="0"+e;return e}var i=e.getUTCFullYear(),n=t(e.getUTCMonth()+1),r=t(e.getUTCDate()),s=t(e.getUTCHours()),o=t(e.getUTCMinutes()),a=t(e.getUTCSeconds()),c=t(e.getUTCMilliseconds(),3);return i+"-"+n+"-"+r+"T"+s+":"+o+":"+a+"."+c+"Z"},f={detect:function(){var e={},t=document.location.search.substring(1);t=t.split("&");for(var i=0;t.length>i;i++){var n=t[i].split("=");e[n[0].toLowerCase()]=n[1]}return e}},g={log:function(e,t){t="[segmentio] "+t,e&&"undefined"!=typeof console&&console&&console.log?console.log(t):"undefined"!=typeof console&&console&&console.warn&&console.warn(t)}},p={providers:[g],level:3,toOrdinal:function(e){return"verbose"===e?0:"error"===e?1:2},addLogger:function(e){this.providers.push(e)},setLevel:function(e){this.level=this.toOrdinal(e)},log:function(e,t,i,n){var r=this.toOrdinal(e);if(r>=this.level){n&&(i="["+n+"] "+i);for(var s=0;this.providers.length>s;s+=1)this.providers[s].log(t,i)}}},v={name:"jsonp",enabled:!0,scriptTags:{},callbacks:{},supported:function(){return!0},removeScriptTag:function(e){e in this.scriptTags&&(this.scriptTags[e].parentNode.removeChild(this.scriptTags[e]),this.scriptTags[e]=null,delete this.scriptTags[e])},callback:function(e,t){if(this.removeScriptTag(e),e in this.callbacks){var i=this.callbacks[e];return delete this.callbacks[e],i(t.success,t.data)}},send:function(e,t,i){t.callback="segment.callback",this.callbacks[""+t.callbackId]=i;var n=a(t);if(n.length>1500)return p.log("error",!1,"Supplied data exceeds maximum size (1500 JSON characters).",t.callbackId),i(!1,{code:"CHAR_LIMIT_EXCEEDED",message:"Exceeded limit of 1500 JSON characters per request."});var r=o.encode(n);r=encodeURIComponent(r),e+="?data="+r;var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.defer=!0,s.src=e;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(s,c)}},m={name:"cors",enabled:!0,supported:function(){if("XMLHttpRequest"in window){var e=new XMLHttpRequest;return"withCredentials"in e?!0:!1}return!1},send:function(e,t,i){var n=this,r=a(t);if(r.length>1500)return p.log("error",!1,"Supplied data exceeds maximum size (1500 JSON characters).",t.callbackId),i(!1,{code:"CHAR_LIMIT_EXCEEDED",message:"Exceeded limit of 1500 JSON characters per request."});var s=new XMLHttpRequest;s.onload=function(e){if(e&&e.target&&e.target.responseText){var t=200===e.target.status;if(t||(n.enabled=!1,b.init()),JSON&&JSON.parse)try{var r=JSON.parse(e.target.responseText);i(t,r)}catch(s){p.log("error",!1,"Failed to parse API response as json : "+e.target.responseText),i(!1,s)}else i(t,{})}else i(!1,e)},s.open("POST",e,!0),s.setRequestHeader("Content-Type","text/plain"),s.send(r)}},b={providers:[m,v],selected:null,init:function(){for(var e=0;this.providers.length>e;e+=1)if(this.providers[e].supported()&&this.providers[e].enabled)return this.selected=this.providers[e],p.log("verbose",!0,"Selected "+this.selected.name+" as API transport."),!0;return!1},send:function(e,t,i){return this.selected.send(e,t,i)}};b.init();var y={name:"utm",get:function(){var e=f.detect(),t={source:e.utm_source,medium:e.utm_medium,term:e.utm_term,content:e.utm_content,campaign:e.utm_campaign},i=u.clean(t);return i>0?t:null}},k={enabled:!1,config:{baseUrl:("https:"===document.location.protocol?"https://":"http://")+"api2.segment.io",apiVersion:"v1",apiKey:null,loadedPageEventName:"Loaded a page",cookie:{delimiter:"----",key:"_sio",duration:730,secure:!1,path:"/"}},user:{id:null,session:null},stats:{requests:0,successful:0,failed:0,identifies:0,tracks:0},visitSources:[],visitContext:null,pageSources:[y],pageContext:null,isEnabled:function(){var e=navigator.userAgent,t=/(google web preview|googlebot)/i.test(e)||/yahoo/i.test(e)||/bingbot/i.test(e);return!t},initialize:function(t,i){return u.isObject(i)||(i={verbose:!1}),u.isString(t)&&0!==t.length?(this.config.apiKey=t,i.verbose&&p.setLevel("verbose"),this.readCookie(),this.enabled=this.isEnabled(),this.enabled&&(this.buildContexts(),this.user.session&&""!==this.user.session||(this.user.session=d.create(),this.writeCookie()),this.track(this.config.loadedPageEventName,this.pageContext)),e):p.log("error",!1,"Please call initialize with a valid apiKey string as the first argument.")},readCookie:function(){var e=c.get(this.config.cookie.key);if(e){var t=e.split(this.config.cookie.delimiter);t.length>=1&&""!==t[0]&&(this.user.session=t[0]),t.length>=2&&""!==t[1]&&(this.user.id=t[1])}},writeCookie:function(){var e=[this.user.session,this.user.id].join(this.config.cookie.delimiter);this.setCookie(this.config.cookie.key,e)},setCookie:function(e,t){var i=this.config;c.set(e,t,i.cookie.duration,null,i.cookie.path,i.cookie.secure)},identify:function(t,i,n){if(t===e||u.isFunction(t))return p.log("error",!1,"Identify must be called with either userId or {traits}.");u.isFunction(i)&&(n=i,i=e);var r=!1;return u.isObject(t)&&(i=t,t=this.user.id),u.isNumber(t)&&(t=""+t),u.isString(t)||null===t||t===e?(this.user.id!==t&&(r=!0,u.isEmail(t)||p.log("verbose",!0,"This userId: "+t+" doesnt appear to be an email - we recommend"+" using an email :)"),this.user.id&&(this.user.session=d.create()),this.user.id=t,this.writeCookie()),i=i||{},!u.isObject(i)||u.isArray(i)||u.isDate(i)?p.log("error",!1,"Identify {traits} (second argument) must be a javascript object."):(u.keys(i).length>0&&(r=!0),r?this.enabled?(i=this.cleanProperties(i),p.log("verbose",!1,["Identifying user:",this.user.id?this.user.id:"anonymous","traits:",a(i)].join(" ")),this.request("/i",{sessionId:this.user.session,userId:this.user.id,traits:i,context:this.visitContext},n),this.stats.identifies+=1):p.log("error",!1,"The segmentio client is not initialized. Either segment.initialize wasnt called, or this is a search spider."):u.isFunction(n)&&n(!0),e)):p.log("error",!1,"Identify requires the userId to be either a string or a number.")},buildContexts:function(){this.visitContext=this.buildVisitContext(),this.pageContext=this.buildPageViewProperties()},buildVisitContext:function(){var e={language:r.language};return this.buildContext(e,this.visitSources),e},buildPageViewProperties:function(){var e={url:n.location.href,referrer:n.referrer,userAgent:r.userAgent};return this.buildContext(e,this.pageSources),e},buildContext:function(e,t){for(var i=0;t.length>i;i+=1)if(t[i].get&&u.isString(t[i].name)){var n=t[i].get();n&&(e[t[i].name]=n)}},track:function(t,i,n){if(u.isFunction(i)&&(n=i,i=e),!u.isString(t)){var r="Track must be called with an event name (string as the first argument).";return p.log("error",!1,r),u.isFunction(n)&&n(!1,{message:r}),e}i=i||{},u.isObject(i)?this.enabled?(i=this.cleanProperties(i),p.log("verbose",!0,["Beginning track:",t,"user:",this.user.id?this.user.id:"anonymous","properties:",a(i)].join(" ")),this.request("/t",{userId:this.user.id,sessionId:this.user.session,event:t,properties:i,context:this.visitContext},n),this.stats.tracks+=1):p.log("error",!1,"The segmentio client is not initialized. Either segment.initialize wasnt called, or this is a search spider."):p.log("error",!1,"Track {properties} (second argument) must be a javascript object.")},request:function(e,t,i){var n=this,r=this.config.baseUrl+"/"+this.config.apiVersion+e;this.fillCommonPayload(t,i),p.log("verbose",!0,["/t"===e?"Track":"Identify","started",a(t)].join(" "),t.callbackId),b.send(r,t,function(e,r){if(e)p.log("verbose",e,"Segment.io API call succeeded.",r.callbackId),n.stats.successful+=1;else{var s="CONNECT_ERR",o="Failed to connect to API endpoint.";r&&(r.code&&(s=r.code),r.message&&(o=r.message),r.data&&(s=r.data.code,o=r.data.message));var a="Segment.io API call failed; code: "+s+" message: "+o;n.stats.failed+=1,p.log("error",e,a,t.callbackId)}i&&i(e,r)}),this.stats.requests+=1},cleanProperties:function(e,t){if(t){if(t>5)return p.log("error",!1,"Invalid property because it has nested objects more than 4 levels deep."),{}}else t=0;for(var i={},n=u.keys(e),r=0;n.length>r;r+=1){var s=n[r],o=e[s];if(o===window)p.log("error",!1,'Woah! You can not pass in the "window" object into segmentio API calls.');else if(u.isDate(o)||u.isArray(o)||!u.isObject(o))u.isArray(o)?p.log("error",!1,"Property "+s+" is invalid because it is an array"):u.isValidPrimitiveValue(o)?i[s]=o:p.log("error",!1,"Property "+s+" is an invalid type");else{var a=this.cleanProperties(o,t+1);u.keys(a).length>0&&(i[s]=a)}}return i},fillCommonPayload:function(e){e.apiKey=this.config.apiKey,e.callbackId=Math.floor(1e3*Math.random())}},w={initialize:function(e,t){return k.initialize(e,t)},identify:function(e,t,i){return k.identify(e,t,i)},track:function(e,t,i){return k.track(e,t,i)},callback:function(e){"jsonp"===b.selected.name&&e.data.callbackId&&v.callback(e.data.callbackId,e)},logLevel:function(e){p.setLevel(e)},verbose:function(e){e?p.setLevel("verbose"):p.setLevel("silent")},addLogger:function(e){e&&e.log&&p.addLogger(e)},baseUrl:function(e){k.config.baseUrl=e},client:function(e){e(k)}};w.init=w.initialize;for(var C=function(e){if(e&&e.length)for(var t=0;e.length>t;t+=1)this.push(e[t])},S=function(e){return function(){this.push([e].concat(Array.prototype.slice.call(arguments,0)))}},j=u.keys(w),T=0;j.length>T;T+=1)C.prototype[j[T]]=S(j[T]);C.prototype.init=C.prototype.initialize,C.prototype.push=function(e){if(e)if(u.isArray(e)){var t=e.splice(0,1);w[t]?setTimeout(function(){try{w[t].apply(w,e)}catch(i){p.log("error",!1,"Internal error: "+i.stack)}},1):p.log("error",!1,t+" is not a valid segment.io action.")}else u.isFunction(e)&&e()},s.wait(function(){window.seg?setTimeout(function(){window.segment=window.seg=new C(window.seg)},100):window.segment&&setTimeout(function(){window.segment=new C(window.segment)},100)})})();